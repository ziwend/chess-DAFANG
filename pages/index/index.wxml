<view class="container">
    <view class="game-status">
        <text class="status-text" style="font-size: {{boardRectCache.cellSize * 0.2}}px;">{{message || (currentPlayer === 0 ? 'é»‘æ–¹å›åˆ' : 'ç™½æ–¹å›åˆ')}}</text>
        <text wx:if="{{extraMoves > 0}}" class="extra-moves" style="font-size: {{boardRectCache.cellSize * 0.2}}px;">å‰©ä½™æ¬¡æ•°: {{extraMoves}}</text>
    </view>

    <!-- é»‘å­æ£‹ç›’ -->
    <view class="player-box">
        <!-- å·¦ä¾§ç®­å¤´æŒ‰é’® -->
    <view class="arrow" wx:if="{{currentPlayer === 0}}"
          style="width: {{boardRectCache.cellSize * 0.5}}px; left: calc(50% - {{boardRectCache.cellSize * 1.4}}px)">
        <text>-></text> <!-- ç®­å¤´æ–¹å‘å¯æ ¹æ®éœ€è¦è°ƒæ•´ -->
    </view>
        <view class="piece-box black-box" style="width: {{boardRectCache.cellSize * 1.5}}px; height: {{boardRectCache.cellSize * 0.9}}px;">
            <view class="piece black" style="width: {{boardRectCache.pieceSize}}px; height: {{boardRectCache.pieceSize}}px;">
                <text class="piece-count">x{{blackCount}}</text>
            </view>
        </view>
        <view class="stats-card" wx:if="{{playerConfig.black.playerType === 'self'}}" style="left: calc(50% + {{boardRectCache.cellSize * 0.85}}px )">
            <view class="points-icon">ğŸ…{{playerStats.totalPoints}}</view>
            <text class="help-icon" bindtap="toggleDailyTasks">?</text>
        </view>
        <!-- ç‹¬ç«‹å®šä½çš„éš¾åº¦æ¡ -->
        <view class="difficulty-bar" wx:if="{{playerConfig.black.playerType === 'local'}}" bindtap="goToPlayerSetting" data-color="black" style="left: calc(50% + {{boardRectCache.cellSize * 0.85}}px)">
            <text class="star active">â˜…</text>
    <text class="star {{playerConfig.black.difficulty === 'medium' || playerConfig.black.difficulty === 'hard' ? 'active' : ''}}">â˜…</text>
    <text class="star {{playerConfig.black.difficulty === 'hard' ? 'active' : ''}}">â˜…</text>
        </view>

    </view>
    <!-- å°†æ¯æ—¥ä»»åŠ¡ç§»åˆ°player-boxä¸‹æ–¹ -->
    <block wx:if="{{showDailyTasks && playerConfig.black.playerType === 'self'}}">
        <view class="daily-tasks">
            <view class="task-container">
                <view class="rank" style="font-size: {{boardRectCache.cellSize * 0.2}}px;">{{playerStats.rank}}</view>
                <view class="task" wx:for="{{dailyTasks}}" wx:key="id">
                    <text style="font-size: {{boardRectCache.cellSize * 0.2}}px;">{{item.desc}}</text>
                    <text style="font-size: {{boardRectCache.cellSize * 0.2}}px;">{{item.completed ? 'å·²å®Œæˆ' : item.points + 'ç§¯åˆ†'}}</text>
                </view>
            </view>
        </view>
    </block>
    <view class="board-container" bindtouchend="handleTouchEnd">
        <!-- æ‚¬æµ®çš„å¼€å§‹æŒ‰é’® -->
        <button class="floating-start-button" bindtap="{{isGameOver ? 'restartGame' : 'startGame'}}" wx:if="{{!isGameStarted}}"></button>
        <!-- æ£‹ç›˜è’™ç‰ˆ -->
        <view class="board-overlay" wx:if="{{!isGameStarted}}"></view>

        <view class="board" style="width: {{boardRectCache.boardSize}}px; height: {{boardRectCache.boardSize}}px;" bindtouchstart="handleTouchStart" bindtouchmove="handleTouchMove" >
            <!-- æ–°å¢ä¸€å±‚ï¼Œå•ç‹¬ç»˜åˆ¶ movingPiece -->
            <view wx:if="{{movingPiece}}" class="piece moving-piece {{movingPiece.color}}" animation="{{moveAnimation}}" style="width: {{boardRectCache.pieceSize}}px; height: {{boardRectCache.pieceSize}}px; left: {{movingPiece.currentX}}px; top: {{movingPiece.currentY}}px;">
            </view>
            <!-- æ¨ªçº¿ -->
            <view class="horizontal-lines">
                <view class="horizontal-line" wx:for="{{6}}" wx:key="index" style="top: {{index * boardRectCache.cellSize}}px; width: {{boardRectCache.boardSize}}px;">
                </view>
            </view>

            <!-- ç«–çº¿ -->
            <view class="vertical-lines">
                <view class="vertical-line" wx:for="{{6}}" wx:key="index" style="left: {{index * boardRectCache.cellSize}}px; height: {{boardRectCache.boardSize}}px;">
                </view>
            </view>

            <!-- äº¤å‰ç‚¹å’Œæ£‹å­ -->
            <view wx:for="{{board}}" wx:for-item="row" wx:for-index="rowIndex" wx:key="rowIndex">
                <view wx:for="{{row}}" wx:for-item="cell" wx:for-index="colIndex" wx:key="colIndex">
                    <view class="intersection" style="left: {{colIndex * boardRectCache.cellSize}}px; top: {{rowIndex * boardRectCache.cellSize}}px;" data-row="{{rowIndex}}" data-col="{{colIndex}}">
                        <view wx:if="{{cell}}" class="piece  static-piece {{cell.color}} {{cell.isFormation ? 'formation-border' : ''}} {{flashPiece.row === rowIndex && flashPiece.col === colIndex ? 'flash' : ''}}" style="width: {{boardRectCache.pieceSize}}px; height: {{boardRectCache.pieceSize}}px;" data-row="{{rowIndex}}" data-col="{{colIndex}}" data-color="{{cell.color}}"  bindanimationend="onAnimationEnd">
                        </view>
                    </view>
                </view>
            </view>

        </view>
    </view>
    <!-- ç™½å­æ£‹ç›’ -->
    <view class="player-box">

        <!-- å·¦ä¾§ç®­å¤´ -->
    <view class="arrow" wx:if="{{currentPlayer === 1}}"
          style="width: {{boardRectCache.cellSize * 0.5}}px; left: calc(50% - {{boardRectCache.cellSize * 1.4}}px)">
        <text>-></text> <!-- ç®­å¤´æ–¹å‘å¯æ ¹æ®éœ€è¦è°ƒæ•´ -->
    </view>
        <view class="piece-box white-box" style="width: {{boardRectCache.cellSize * 1.5}}px; height: {{boardRectCache.cellSize * 0.9}}px;">
            <view class="piece white" style="width: {{boardRectCache.pieceSize}}px; height: {{boardRectCache.pieceSize}}px;">
                <text class="piece-count">x{{whiteCount}}</text>
            </view>

        </view>
        <view class="stats-card" wx:if="{{playerConfig.white.playerType === 'self'}}" style="left: calc(50% + {{boardRectCache.cellSize * 0.75}}px + 10rpx)">
            <view class="points-icon">ğŸ…{{playerStats.totalPoints}}</view>
            <text class="help-icon" bindtap="toggleDailyTasks">?</text>
        </view>
        <!-- ç‹¬ç«‹å®šä½çš„éš¾åº¦æ¡ -->
        <view class="difficulty-bar" wx:if="{{playerConfig.white.playerType === 'local'}}" bindtap="goToPlayerSetting" data-color="white" style="left: calc(50% + {{boardRectCache.cellSize * 0.75}}px + 10rpx)">
          <view class="stars-container">
    <text class="star active">â˜…</text>
    <text class="star {{playerConfig.white.difficulty === 'medium' || playerConfig.white.difficulty === 'hard' ? 'active' : ''}}">â˜…</text>
    <text class="star {{playerConfig.white.difficulty === 'hard' ? 'active' : ''}}">â˜…</text>
  </view>
        </view>

    </view>

    <!-- å°†æ¯æ—¥ä»»åŠ¡ç§»åˆ°player-boxä¸‹æ–¹ -->
    <block wx:if="{{showDailyTasks && playerConfig.white.playerType === 'self'}}">
        <view class="daily-tasks">
            <view class="task-container">
                <view class="rank" style="font-size: {{boardRectCache.cellSize * 0.2}}px;">{{playerStats.rank}}</view>
                <view class="task" wx:for="{{dailyTasks}}" wx:key="id">
                    <text style="font-size: {{boardRectCache.cellSize * 0.2}}px;">{{item.desc}}</text>
                    <text style="font-size: {{boardRectCache.cellSize * 0.2}}px;">{{item.completed ? 'å·²å®Œæˆ' : item.points + 'ç§¯åˆ†'}}</text>
                </view>

            </view>
        </view>
    </block>


    <view class="controls">
        <!-- æ¸¸æˆæœªå¼€å§‹æ—¶æ˜¾ç¤ºâ€œæ›´å¤šè®¾ç½®â€æŒ‰é’® -->
        <button class="control-button" bindtap="openMenu" wx:if="{{!isGameStarted}}">
            <view class="settings-icon">âš™ï¸</view>
        </button>

        <!-- æ¸¸æˆå¼€å§‹åæ˜¾ç¤ºâ€œé‡æ–°å¼€å§‹â€æŒ‰é’® -->
        <button class="control-button" bindtap="restartGame" wx:if="{{isGameStarted}}">
            <view class="restart-icon">â†»</view>
        </button>

        <view class="timer" wx:if="{{isGameStarted}}">
            <text>{{elapsedTime}}</text>
        </view>

        <button class="control-button" bindtap="goToRules" wx:if="{{!isGameStarted}}">
            <view class="rules-icon">ğŸ“œ</view>
        </button>
        <!-- æ‚”æ£‹æŒ‰é’® -->
        <button class="control-button" wx:if="{{isGameStarted}}" bindtap="undoMove">
            <view class="back-icon">â†©</view>
        </button>
    </view>
</view>